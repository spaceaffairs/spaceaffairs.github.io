<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>I.A.S.A.</title>
    <link rel="stylesheet" href='styles/style.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="canonical" href="https://spaceaffairs.github.io/index.html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Official Website of the International Agency for Space Affairs">
    <meta name="keywords" content="dance, art, choreography, VR, performance, augmented reality, contemporary art, virtual reality, unity, quest, oculus, pedagogy, self-organisation, math, mathematics, spirituality, decolonial, anticolonial, queer">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
</head>
<body>
    <main>
        <script src="menu.js"></script>
    </main>
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
            "imports": {
            "three": "https://unpkg.com/three@0.156.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.156.1/examples/jsm/"
            }
        }
    </script>

    <!--<section id="loading-screen">

        <div id="loader"></div>

    </section>-->

    <div class="progress-bar-container">
        <label for="progress-bar">Loading...</label>
        <progress id="progress-bar" value="0" max="100"></progress>
    </div>
    <div class="iasaLogo">
        <img class="iasa" src='images/IASA_logo_grau.svg'>
    </div>
    <script type="module">

        import * as THREE from 'https://unpkg.com/three@0.156.1/build/three.module.js'
        import { OrbitControls } from 'https://unpkg.com/three@0.156.1/examples/jsm/controls/OrbitControls.js';
        import { PLYLoader } from 'https://unpkg.com/three@0.156.1/examples/jsm/loaders/PLYLoader.js';

        const container = document.getElementById('container');

        let renderer, scene, camera, /*clock,*/ mesh;

        init();
        animate();

        function init() {

            //var clock = new THREE.Clock();
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });

            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = 30;


            const controls = new OrbitControls(camera, renderer.domElement);
            controls.minDistance = 10;
            controls.maxDistance = 30;


            const manager = new THREE.LoadingManager();
                //() => {

            //    const loadingScreen = document.getElementById('loading-screen');
            //    loadingScreen.classList.add('fade-out');

            //    // optional: remove loader from DOM via event listener
            //    loadingScreen.addEventListener('transitionend', onTransitionEnd);
            //});

            manager.onStart = function (url, itemsLoaded, itemsTotal) {
                console.log('Started loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.');
            };

            const progressbarContainer = document.querySelector('.progress-bar-container');
            manager.onLoad = function () {
                progressbarContainer.style.display = 'none';
                console.log('Loading complete!');
            };
            const progressBar = document.getElementById('progress-bar');

            manager.onProgress = function (url, itemsLoaded, itemsTotal) {
                progressBar.value= ()
                console.log('Loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.');
            };

            //manager.onError = function (url) {
            //    console.log('There was an error loading ' + url);
            //};

            const loader = new PLYLoader(manager);


            loader.load('3D/models/ply/Leafs07_clean_300K.ply', function (geometry) {

                const material = new THREE.PointsMaterial({ size: 0.01, vertexColors: true });
                mesh = new THREE.Points(geometry, material);
                mesh.name = "ply";
                mesh.position.x = - 0.2;
                mesh.position.y = - 0.52;
                mesh.position.z = - 0.0;
                mesh.scale.multiplyScalar(30);
                mesh.castShadow = true;
                mesh.receiveShadow = true;

                scene.add(mesh);
            });

            mesh = scene.getObjectByName("ply");





            window.addEventListener('resize', onWindowResize);

            let moved = false;

            controls.addEventListener('change', function () {

                moved = true;

            });

            window.addEventListener('pointerdown', function () {

                moved = false;

            });



        }


        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }


        function animate() {

            renderer.setAnimationLoop(render);



        }

        function render() {
            renderer.render(scene, camera);
            //var t = performance.now() * 0.000001;
            //mesh.rotateY(clock.getElapsedTime() * 0.001);
        }

    </script>

</body>
</html>
