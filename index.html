<!DOCTYPE html>
<html>
<script src="header.js"></script>

<body>
    <main>
        <head>
            <meta charset="utf-8">
            <title>I.A.S.A.</title>
            <link rel="stylesheet" href="styles/style.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="canonical" href="https://spaceaffairs.github.io/index.html" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta name="description" content="Official Website of the International Agency for Space Affairs">
            <meta name="keywords" content="dance, art, choreography, VR, performance, augmented reality, contemporary art, virtual reality, unity, quest, oculus, pedagogy, self-organisation, math, mathematics, spirituality, decolonial, anticolonial, queer" />
        </head>
    </main>
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.156.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.156.1/examples/jsm/"
          }
        }
    </script>

    <!-- <canvas id="c"></canvas> -->
    <div class="iasaLogo">
        <img class="iasa" src="images/IASA_logo_grau.svg">
    </div>
    <script type="module">

        import * as THREE from 'https://unpkg.com/three/build/three.module.js'
        import Stats from 'https://unpkg.com/three/examples/jsm/libs/stats.module.js'
        import { OrbitControls } from 'https://unpkg.com/three/examples/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from 'https://unpkg.com/three/examples/jsm/loaders/GLTFLoader.js';
        import { PLYLoader } from 'https://unpkg.com/three/examples/jsm/loaders/PLYLoader.js';
        import { RenderPass } from 'https://unpkg.com/three/examples/jsm/postprocessing/RenderPass.js';
        import { EffectComposer } from 'https://unpkg.com/three/examples/jsm/postprocessing/EffectComposer.js';
        import { UnrealBloomPass } from 'https://unpkg.com/three/examples/jsm/postprocessing/UnrealBloomPass.js';
        //import { VRButton } from 'https://unpkg.com/three/examples/jsm/webxr/VRButton.js';

        const container = document.getElementById('container');

        let renderer, scene, camera, stats, composer, renderScene, bloomPass, bulbLight;
        let mesh;

        init();
        animate();

        function init() {

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            //renderer.xr.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.body.appendChild(renderer.domElement);
            //container.appendChild(renderer.domElement);
            //document.body.appendChild(VRButton.createButton(renderer));

            stats = new Stats();
            document.body.appendChild(stats.dom);
            //container.appendChild(stats.dom);

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = 30;

            renderScene = new RenderPass(scene, camera);
            composer = new EffectComposer(renderer);
            composer.addPass(renderScene);

            bloomPass = new UnrealBloomPass(
                new THREE.Vector2(window.innerWidth, window.innerHeight),
                0.9,
                0.1,
                0.1
            );
            composer.addPass(bloomPass);
            const controls = new OrbitControls(camera, renderer.domElement);
            controls.minDistance = 10;
            controls.maxDistance = 30;

            scene.add(new THREE.AmbientLight(0x666666));


            const bulbGeometry = new THREE.SphereGeometry(0.22, 16, 8);
            bulbLight = new THREE.PointLight(0xffee88, 100, 100, 2);

            let bulbMat = new THREE.MeshStandardMaterial({
                emissive: 0xffffff,
                emissiveIntensity: 1,
                color: 0x000000
            });

            bulbLight.add(new THREE.Mesh(bulbGeometry, bulbMat));
            bulbLight.position.set(0, 3, 0);
            bulbLight.castShadow = true;

            scene.add(bulbLight);


            let floorMat = new THREE.MeshStandardMaterial({
                roughness: 0.8,
                color: 0xffffff,
                metalness: 0.2,
                bumpScale: 0.0005
            });




            const planeGeometry = new THREE.PlaneGeometry(200, 200, 32, 32);
            planeGeometry.rotateX(- Math.PI / 2);
            const planeMaterial = new THREE.MeshStandardMaterial({ color: 0xaaaaaa })
            const plane = new THREE.Mesh(planeGeometry, floorMat);// planeMaterial);
            plane.position.y = -7;
            plane.receiveShadow = true;
            scene.add(plane);



            loadPLY();


            window.addEventListener('resize', onWindowResize);

            let moved = false;

            controls.addEventListener('change', function () {

                moved = true;

            });

            window.addEventListener('pointerdown', function () {

                moved = false;

            });



        }

        function loadPLY() {
            const loader = new PLYLoader();


            loader.load('3D/models/ply/Leafs07_clean_300K.ply', function (geometry) {

                const material = new THREE.PointsMaterial({ size: 0.01, vertexColors: true });
                const mesh = new THREE.Points(geometry, material);

                mesh.position.x = - 0.2;
                mesh.position.y = - 0.52;
                mesh.position.z = - 0.0;
                mesh.scale.multiplyScalar(10);
                mesh.castShadow = true;
                mesh.receiveShadow = true;

                scene.add(mesh);
            });
        }



        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }


        function animate() {

            renderer.setAnimationLoop(render);



        }

        function render() {
            composer.render();
        }

    </script>

</body>
</html>
